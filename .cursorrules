# R√®gles Cursor pour Jennynbevent

## üîí R√®gles de S√©curit√© des Migrations (CRITIQUE)

### ‚ö†Ô∏è INTERDICTIONS ABSOLUES dans les migrations SQL

**JAMAIS** utiliser ces commandes dans les migrations :

1. **`DROP SCHEMA IF EXISTS "public" CASCADE;`**
   - ‚ùå INTERDIT - Supprime TOUTES les donn√©es de la base
   - ‚úÖ Utiliser √† la place : `CREATE SCHEMA IF NOT EXISTS "public";`

2. **`DROP DATABASE`**
   - ‚ùå INTERDIT - Supprime compl√®tement la base de donn√©es

3. **`TRUNCATE TABLE ... CASCADE;`**
   - ‚ùå DANGEREUX - Supprime toutes les donn√©es et d√©pendances
   - ‚úÖ Utiliser `DELETE FROM table WHERE condition` si n√©cessaire

4. **`DELETE FROM table;`** (sans clause WHERE)
   - ‚ùå INTERDIT - Supprime toutes les lignes
   - ‚úÖ Toujours inclure une clause WHERE sp√©cifique

5. **`DROP TABLE ... CASCADE;`**
   - ‚ö†Ô∏è ATTENTION - Supprime la table et ses d√©pendances
   - ‚úÖ Utiliser `DROP TABLE IF EXISTS` sans CASCADE si possible

### ‚úÖ Bonnes Pratiques OBLIGATOIRES

1. **Toujours utiliser `CREATE TABLE IF NOT EXISTS`**
   ```sql
   -- ‚úÖ CORRECT
   CREATE TABLE IF NOT EXISTS "users" (...);
   ```

2. **Toujours utiliser `CREATE SCHEMA IF NOT EXISTS`**
   ```sql
   -- ‚úÖ CORRECT
   CREATE SCHEMA IF NOT EXISTS "public";
   ```

3. **Valider AVANT de cr√©er une migration**
   - Ex√©cuter : `npm run validate:migration <fichier>`
   - V√©rifier qu'aucune commande dangereuse n'est pr√©sente

4. **Cr√©er un backup AVANT d'appliquer en production**
   - Ex√©cuter : `npm run backup:before-migration production`
   - Toujours avoir un backup r√©cent avant toute migration

### üìã Checklist OBLIGATOIRE avant chaque migration

Avant de cr√©er ou modifier une migration SQL, v√©rifier :

- [ ] ‚úÖ Pas de `DROP SCHEMA ... CASCADE`
- [ ] ‚úÖ Pas de `DROP DATABASE`
- [ ] ‚úÖ Pas de `TRUNCATE ... CASCADE`
- [ ] ‚úÖ Pas de `DELETE FROM` sans WHERE
- [ ] ‚úÖ Utilise `CREATE TABLE IF NOT EXISTS`
- [ ] ‚úÖ Utilise `CREATE SCHEMA IF NOT EXISTS`
- [ ] ‚úÖ Migration valid√©e avec `npm run validate:migration`
- [ ] ‚úÖ Backup cr√©√© avant application en prod

### üö® En cas de doute

Si tu n'es pas s√ªr qu'une commande SQL est s√ªre :
1. **NE PAS** l'utiliser
2. Demander confirmation avant de cr√©er la migration
3. Consulter `docs/MIGRATION_SAFETY.md` pour les r√®gles compl√®tes

### üìö R√©f√©rences

- Guide complet : `docs/MIGRATION_SAFETY.md`
- Guide rapide : `README_MIGRATION.md`
- Script de validation : `scripts/validate-migration-safety.ts`
- Script de backup : `scripts/backup-before-migration.ts`

## Autres R√®gles du Projet

### Superforms
- Toujours retourner le form object m√™me en cas d'erreur (sinon le front-end bug)
- Toute la logique Superforms doit √™tre c√¥t√© serveur
- C√¥t√© client, utiliser uniquement `enhance` de SvelteKit sans importer Superforms

### Validation
- Centraliser tous les sch√©mas de validation dans `lib/validations/schemas`
- R√©utiliser `commonSchemas` dans `product.ts` et autres fichiers de validation
- Modifier les sch√©mas existants plut√¥t que d'en cr√©er de nouveaux

### Actions
- D√©finir les actions directement dans les fichiers `+page.server.ts` correspondants
- Ne pas utiliser de dossier `lib/actions` partag√©

### Organisation des fichiers
- Cr√©er les nouveaux fichiers dans les dossiers `src/lib` appropri√©s
- Cr√©er de nouveaux r√©pertoires si n√©cessaire pour maintenir une organisation propre

### Design
- Aligner le design UI avec le style marketing
- Utiliser des tokens de design globaux ou variables de style pour les couleurs, polices, etc.
- Les changements doivent se propager de mani√®re coh√©rente dans toute l'application







